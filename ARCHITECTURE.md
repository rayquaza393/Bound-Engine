# Bound Engine - Architecture Overview

## System Architecture Diagram

```
???????????????????????????????????????????????????????????????????
?                     Bound::Application                          ?
?                  (Main Game Loop Container)                     ?
?                                                                 ?
?  ???????????????????????????????????????????????????????????   ?
?  ?                  Game Implementation                     ?   ?
?  ?  (onInit, onUpdate, onRender, onShutdown overrides)    ?   ?
?  ???????????????????????????????????????????????????????????   ?
?                          ?                                      ?
?    ?????????????????????????????????????????????               ?
?    ?                     ?                     ?               ?
?    ?                     ?                     ?               ?
?  ????????          ????????????          ????????????         ?
?  ?Window?          ?Renderer  ?          ?Game Logic?         ?
?  ????????          ????????????          ????????????         ?
???????????????????????????????????????????????????????????????????
    ?                     ?
    ?                     ?
    ?                     ?
???????????????????  ????????????????????????????????????
?   Platform      ?  ?        Rendering Pipeline        ?
?   Window        ?  ?                                  ?
?                 ?  ?  ????????????????????????????    ?
? - Win32 API     ?  ?  ? Camera                   ?    ?
? - Input Events  ?  ?  ? (View/Projection Matrix) ?    ?
? - Key/Mouse     ?  ?  ????????????????????????????    ?
? - Display Sync  ?  ?            ?                     ?
?                 ?  ?            ?                     ?
???????????????????  ?  ????????????????????????????    ?
                     ?  ? Mesh/Vertex Processing   ?    ?
                     ?  ? (World->Screen Space)    ?    ?
                     ?  ????????????????????????????    ?
                     ?            ?                     ?
                     ?            ?                     ?
                     ?  ????????????????????????????    ?
                     ?  ? Triangle Rasterization   ?    ?
                     ?  ? (Current: Wireframe)     ?    ?
                     ?  ????????????????????????????    ?
                     ?            ?                     ?
                     ?            ?                     ?
                     ?  ????????????????????????????    ?
                     ?  ? Framebuffer              ?    ?
                     ?  ? (Pixel Buffer + Depth)   ?    ?
                     ?  ????????????????????????????    ?
                     ????????????????????????????????????
                                  ?
                                  ?
                     ????????????????????????
                     ?  Display to Screen   ?
                     ? (Window::present)    ?
                     ????????????????????????
```

## Data Flow: Rendering a Frame

```
???????????????????????
? Application::run()  ?
???????????????????????
           ?
           ?
    ???????????????
    ? Update Loop ? (Main game loop)
    ???????????????
           ?
    ???????????????
    ?             ?
    ?             ?
??????????   ????????????
? Input  ?   ? Game     ?
?Process ?   ? Update   ?
??????????   ????????????
    ?             ?
    ???????????????
           ?
           ?
    ??????????????????
    ? Renderer::     ?
    ? beginFrame()   ?
    ? - Clear buffer?
    ? - Reset depth ?
    ??????????????????
             ?
             ?
    ?????????????????????
    ? Game::onRender()  ?
    ? (User draws)      ?
    ? - drawMesh()      ?
    ? - drawTriangle()  ?
    ?????????????????????
             ?
             ?
    ??????????????????
    ? Renderer::     ?
    ? endFrame()     ?
    ? - Post FX      ?
    ? - Effects      ?
    ??????????????????
             ?
             ?
    ????????????????????
    ? Window::present()?
    ? - Blit framebuffer
    ? - Swap buffers  ?
    ????????????????????
```

## Class Relationships

```
         ????????????????????????
         ?  Bound::Application  ?
         ?    (Game Base)       ?
         ????????????????????????
                   ?
          ???????????????????
          ?        ?        ?
          ?        ?        ?
       ??????? ???????? ??????????
       ?Graph? ?Render? ?Window  ?
       ?Game ? ?er    ? ?Manager ?
       ??????? ???????? ??????????
                 ?
        ???????????????????
        ?        ?        ?
        ?        ?        ?
     ?????? ???????? ????????????
     ?Mesh? ?Camera? ?Framebuffer?
     ?????? ???????? ????????????
        ?
        ?
    ?????????
    ?Vertex ?
    ?  +    ?
    ? Index ?
    ?????????
```

## Memory Layout: Framebuffer

```
Memory Block:
??????????????????????????????????????????
?  Frame 0, Pixel 0: ARGB (uint32_t)     ? <- pixels_[0]
??????????????????????????????????????????
?  Frame 0, Pixel 1: ARGB (uint32_t)     ? <- pixels_[1]
??????????????????????????????????????????
?  ...                                   ?
??????????????????????????????????????????
?  Frame 0, Pixel N: ARGB (uint32_t)     ? <- pixels_[width*height-1]
??????????????????????????????????????????
?  Depth 0: uint16_t                     ? <- depthBuffer_[0]
??????????????????????????????????????????
?  Depth 1: uint16_t                     ? <- depthBuffer_[1]
??????????????????????????????????????????
?  ...                                   ?
??????????????????????????????????????????
  Pixel layout: 4 bytes per pixel
  Depth layout: 2 bytes per pixel
  Total: 6 bytes per pixel = 1920*1080*6 ? 12.4 MB
```

## Coordinate Systems

### World Space
- 3D coordinates (X, Y, Z)
- Origin typically at scene center or camera
- Units: arbitrary game units

### Camera Space (View Space)
- Coordinates relative to camera
- Camera at origin, looking down Z
- Converted via View matrix

### Clip Space (NDC - Normalized Device Coordinates)
- After perspective division
- Range: [-1, 1] for all axes
- Converted via Projection matrix

### Screen Space
- 2D pixel coordinates
- Range: [0, width] × [0, height]
- Z becomes depth for depth testing

```
World ? View ? Clip ? Screen
         ?      ?      ?
       Matrix Divide Viewport
```

## Key Algorithms

### 1. World to Screen Transformation
```
screen = viewport_transform(perspective_divide(mvp * world_point))
```

### 2. Bresenham Line Drawing
- Integer-only algorithm
- No floating-point calculations
- Efficient for framebuffer rendering

### 3. Depth Testing
- Per-pixel depth comparison
- Prevents far objects overwriting near objects
- Simple z-buffer approach

### 4. Color Blending (Future)
- Planned: Alpha blending for transparency
- Planned: Additive blending for glow
- Planned: Post-process effects

## Threading Model (Current)

```
Main Thread (Everything)
?? Input Processing
?? Game Logic Update
?? Rendering
?? Buffer Swap
```

**Future:** Move rendering to separate thread for async updates.

## CPU vs GPU (Intentional CPU Focus)

| Task | Current | Why |
|------|---------|-----|
| 3D Transform | CPU | Maximum control, portable |
| Rasterization | CPU | Software rasterization |
| Lighting | CPU (vertex) | Gouraud shading |
| Texturing | CPU (future) | Color depth control |
| Post-FX | CPU | Dithering, chromatic aberration |

This is intentional! The engine prioritizes compatibility and artistic control over raw speed.

## Extensibility Points

### User Game Code
```cpp
class MyGame : public Bound::Application {
    void onInit() override;    // One-time setup
    void onUpdate(dt) override; // Per-frame logic
    void onRender() override;   // Per-frame rendering
    void onShutdown() override; // Cleanup
};
```

### Rendering Customization
```cpp
// Subclass Renderer to override rendering behavior
class MyRenderer : public Bound::Renderer {
    void drawTriangle(v0, v1, v2, color) override;
    // Custom rasterization
};
```

### Platform Abstraction
```cpp
// Currently Windows, abstract to base class:
class IWindow { /* interface */ };
class WindowWin32 : public IWindow { /* implementation */ };
class WindowLinux : public IWindow { /* implementation */ };
```

---

## Next Phase: Filled Triangle Rasterization

When implemented, the flow will become:

```
drawTriangle(v0, v1, v2, color)
    ?
Transform to screen space
    ?
Calculate bounding box
    ?
For each pixel in bounding box:
    ?? Calculate barycentric coords
    ?? If inside triangle:
    ?   ?? Calculate perspective-corrected Z
    ?   ?? Depth test
    ?   ?? setPixelWithDepth(x, y, color, z)
```

This will replace the current line-based triangle drawing.

